<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../ì£¼ì„ì—†ëŠ” ver./noDesc.css" />
    <title>Document</title>
  </head>
  <body>
    <header>
      <h1>ìµœê³  í‰ì  ì˜í™” ì½œë ‰ì…˜</h1>
    </header>

    <form id="form">
      <label for="search-input">ì˜í™” ê²€ìƒ‰ : </label>
      <input id="search-input" type="text" placeholder="ì˜í™” ì œëª©ì„ ê²€ìƒ‰í•´ ë³´ì„¸ìš”" autofocus />
      <button type="submit" id="searchMovie">ê²€ìƒ‰</button>

      <audio id="audio" controls loop>
        <source src="../audio/little_dramatic.mp3" />
        <source src="../audio/backgroundMusic.mp3" />
      </audio>
    </form>

    <button class="scrollUp" onclick="window.scrollTo(0,0)">â¬†ï¸</button>

    <section id="cards">
      <div class="card-bg">
        <div class="card-content">
          <img src="https://image.tmdb.org/t/p/w500/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg" alt="movie image" />
          <h3>movie title</h3>
          <p class="card-overview">
            overview : Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum iste voluptas labore adipisci omnis
            sint debitis, consequuntur earum et quasi aut ducimus. Enim ad, sapiente dignissimos amet voluptate quidem
            commodi Lorem ipsum dolor sit amet consectetur adipisicing elit. Pariatur labore modi mollitia tempora
            aspernatur ea, veritatis illum vero nobis iure animi in quis quidem consequuntur, quisquam nostrum maxime
            aliquam neque.
          </p>
          <p class="card-rating">rating 8.5</p>
        </div>
      </div>
    </section>

    <script>
      window.onload = function () {
        getMovieAPI();
      };

      function alertId(movieId) {
        alert(`ì˜í™” id : ${movieId}`);
      }

      const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          Authorization:
            'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhYjdkNzRhNTRiYzEzNTE4ZDgyMTc1MjAzNzM4MzliNSIsInN1YiI6IjY0NzA4OGI1NTQzN2Y1MDE0NzVmMDU0ZSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.FaD0cXTgqDH5QUE4-ZoUBQJFr9fuQMr0VtpdOJEbTxE',
        },
      };

      function getMovieAPI() {
        fetch('https://api.themoviedb.org/3/movie/top_rated?language=en-US&page=1', options)
          .then(response => response.json())
          .then(json => {
            console.log(json);

            displayItems(json);
          })
          .catch(err => console.error(err));
      }

      function displayItems(movieInfos) {
        let movies = movieInfos['results'];

        let parent = document.getElementsByTagName('section')[0];
        let children = parent.querySelectorAll('.card-bg');

        children.forEach(child => {
          parent.removeChild(child);
        });

        movies.forEach(movie => {
          let id = movie['id'];
          let title = movie['title'];
          let overview = movie['overview'];
          let poster_path = 'https://image.tmdb.org/t/p/w500' + movie['poster_path'];
          let vote_average = movie['vote_average'];
          let temp_html = `
          <div class="card-bg">
            <div id="${id}" class="card-content" onclick="alertId(this.id)">
              <!-- ì´ë¯¸ì§€ í¬ê¸° 260*390 -->
              <img src="${poster_path}" alt="movie image" />
              <h3>${title}</h3>
              <p class="card-overview">
                ${overview}
              </p>
              <p class="card-rating">Rating : ${vote_average}</p>
            </div>
          </div>
          `;

          document.getElementsByTagName('section')[0].insertAdjacentHTML('beforeend', temp_html);

          function showSearch(event) {
            event.preventDefault();

            let input_str = document.getElementById('search-input').value; // DOMì˜ ì†ì„± valueë¥¼ ì´ìš©í•´ì„œ í•´ë‹¹ ìš”ì†Œì˜ ê°’ì„ ê°€ì ¸ì˜¤ê¸°
            console.log(input_str);

            // ì!! search inputì„ ê°€ì ¸ì™”ìœ¼ë‹ˆ ì´ì œ í•´ë‹¹ ë¬¸ì(input_str)ë¥¼ í¬í•¨í•œ 'ì˜í™” title'ì„ ê°€ì§„ 'ì˜í™” ì¹´ë“œ'ë¥¼ ë³´ì—¬ì£¼ë©´ ë˜ê² ì£ ?
            /** íŠ¹ì • ë¬¸ìë¥¼ í¬í•¨í•œ ë¬¸ìì—´ ì°¾ê¸°.
            â€» ì„¤ê³„ (ì¼ë‹¨ 'ì˜í™” ë­‰ì¹˜ ì‹ë³„ìëª…ì€ movies!' / 'ì˜í™”ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê³  ì±„ìš¸ ê³µê°„ idëª… = cards' / 'ê° ì¹´ë“œì˜ classëª… : card-bg')
              1. ì¹´ë“œ ë¦¬ìŠ¤íŒ…í•  ê³µê°„ ë¹„ìš°ê¸°!  | ê²€ìƒ‰í•œ ë‚´ìš©ì„ ë°˜ì˜í•´ì„œ, ì¹´ë“œë¥¼ ë³´ì—¬ì¤˜ì•¼í•˜ê¸° ë•Œë¬¸ì—
              2. .forEach() ë©”ì„œë“œë¡œ movieë¥¼ í•˜ë‚˜ì”© ê°€ì ¸ì˜¨ë‹¤. ë‹¨, ifë¬¸ì„ ì´ìš©í•˜ì—¬ input_strì„ í¬í•¨í•˜ëŠ” titleì„ ê°€ì§„ ì˜í™”ë§Œ ê°€ì ¸ì˜¤ê¸°!
              3. í•´ë‹¹ë˜ëŠ” ì˜í™” listë¡œ ë¶™ì—¬ì£¼ê¸°
             */
            // ğŸ€ 1. ì¹´ë“œ ë¦¬ìŠ¤íŒ…í•  ê³µê°„ ë¹„ìš°ê¸°

            let parent = document.getElementsByTagName('section')[0];

            let children = parent.querySelectorAll('.card-bg');

            /** ğŸ’œâœï¸  ã„´ 'document.getElementsByTagName('section')[0]'ì™€ 'DOMì˜ ë©”ì„œë“œ .removeChild()' ë¥¼ ì˜ ì´í•´í•˜ì§€ ëª»í•˜ëŠ” ê²ƒ ê°™ì•„ì„œ í•„ê¸°!
              âœï¸ let parent = document.getElementsByTagName('section')[0] ì¼ ë•Œ
                  -  console.log(parent) ì˜ ê²°ê³¼ëŠ” 0ë²ˆì§¸ì— í•´ë‹¹í•˜ëŠ” section tagë¥¼ í¬í•¨í•œ í•˜ìœ„ìš”ì†Œ ì „ì²´ë¥¼ ì§€ì¹­.
                    ì¦‰, í•´ë‹¹ selectorì— í•´ë‹¹í•˜ëŠ” document(html tag ë‚´ìš©!)ì„ ê°€ë¦¬í‚¨ë‹¤ê³  ë³´ë©´ë¨!!!!
              âœï¸ DOMì˜ ë©”ì„œë“œ 'ìƒìœ„ìš”ì†Œ "ì´ê²ƒ"'.removeChild('í•˜ìœ„ìš”ì†Œ "ì´ê²ƒ"')
                  - ì˜ëª» ì´í•´í•œ ë°©ì‹ : "parent.removeChild(child)ê°€ ìˆì„ ë•Œ, ìƒìœ„ìš”ì†Œ parentì— ìˆëŠ” í•˜ìœ„ 'ì„ íƒìChild'ë¥¼ ëª¨ë‘ ì‚­ì œí•´ì¤˜." --> "[í‹€ë¦°ì´ìœ ëŠ”]ì €ê¸° ë“¤ì–´ê°€ëŠ” childëŠ” ì„ íƒìëª…ì´ ì•„ë‹ˆë¼ documentì„"
                  - ì˜ë¯¸ : 'ìƒìœ„ìš”ì†Œ "ì´ê²ƒ"'ì— ìˆëŠ” 'í•˜ìœ„ìš”ì†Œ "ì´ê²ƒ"'ì„ ì‚­ì œí•´ì¤˜.
             */

            children.forEach(child => {
              parent.removeChild(child);
            });

            // ğŸ€  2. .forEach() ë©”ì„œë“œë¡œ movieë¥¼ í•˜ë‚˜ì”© ê°€ì ¸ì˜¨ë‹¤. ë‹¨, ifë¬¸ì„ ì´ìš©í•˜ì—¬ input_strì„ í¬í•¨í•˜ëŠ” titleì„ ê°€ì§„ ì˜í™”ë§Œ ê°€ì ¸ì˜¤ê¸°!
            // console.log('showSearch()ì—ì„œ movies ì°íˆëŠ”ì§€ test => ', movies); // ì˜ì°í˜
            movies.forEach(movie => {
              let title = movie['title'];

              // 1. ê°€ì ¸ì˜¨ movieì— ìˆëŠ” title ê°€ì ¸ì™€ì„œ input_strê³¼ ë¬¸ìì—´ ë¹„êµ | ë¬¸ìì—´ì— íŠ¹ì • ë¬¸ìê°€ í¬í•¨ì´ ë˜ì—ˆëŠ”ê°€
              // 1-1. ì†ŒëŒ€ë¬¸ì ìƒê´€ì—†ì´ ì°¾ê¸° | ë‘ ë¬¸ìì—´ ì „ë¶€ ì†Œë¬¸ìë¡œ ë³€ê²½ | string.toLowerCase();
              let sTitle = title.toLowerCase();
              let sInput_str = input_str.toLowerCase();

              // // 1-2. ë¬¸ìì—´ í¬í•¨ ì—¬ë¶€ | ë¬¸ìì—´.indexOf(ë¬¸ì) : -1(=false) or 1(true) ë°˜í™˜ // ë¬¸ìì—´.includes(ë¬¸ì) : false or true ë°˜í™˜
              if (sTitle.includes(sInput_str)) {
                let id = movie['id'];
                let overview = movie['overview'];
                let poster_path = 'https://image.tmdb.org/t/p/w500' + movie['poster_path'];
                let vote_average = movie['vote_average'];
                let temp_html = `
                              <div class="card-bg">
                                <div id="${id}" class="card-content" onclick="alertId(this.id)">
                                  <!-- ì´ë¯¸ì§€ í¬ê¸° 260*390 -->
                                  <img src="${poster_path}" alt="movie image" />
                                  <h3>${title}</h3>
                                  <p class="card-overview">
                                    ${overview}
                                  </p>
                                  <p class="card-rating">Rating : ${vote_average}</p>
                                </div>
                              </div>
                              `;
                document.getElementById('cards').insertAdjacentHTML('beforeend', temp_html);
              }
            });
          }

          document.getElementById('form').addEventListener('submit', showSearch);
        });
      }

      /** form data ë°œ/ìˆ˜ì‹ 
      1. ì˜í™” ê²€ìƒ‰ì˜ 'ê²€ìƒ‰ë²„íŠ¼' í´ë¦­ì‹œ 'inputì— ì…ë ¥ëœ ë‚´ìš©' JSë¡œ ì „ì†¡
      2. inputê°’ì˜ false/true íŒë‹¨
        2-1. inputê°’ falseì¼ ê²½ìš° â¡ï¸ alert('ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”') -- ìœ íš¨ì„± ê²€ì‚¬
        2-2. inputê°’ trueì¼ ê²½ìš° â¡ï¸ â“µê²€ìƒ‰ì°½ì— ì…ë ¥ê°’ ë‚¨ê¸´ì±„  â“¶JSì •ë³´ ì²˜ë¦¬í•  ê³³ìœ¼ë¡œ ì „ì†¡
      3. ğŸ’™ ì˜í™” ì •ë³´ê¾¸ëŸ¬ë¯¸ ì¤‘ì— inputê°’ì—ì„œ ë°›ì€ ì •ë³´(ë¬¸ìì—´)ë¥¼ í¬í•¨í•˜ëŠ” 'ì˜í™”ì œëª©'ì„ ì°¾ì•„
        í•´ë‹¹ ì˜í™”ì¹´ë“œë§Œ ë³´ì—¬ì£¼ê¸°
      */
    </script>
  </body>
</html>
